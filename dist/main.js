"use strict";$.fn.keyboard=function(e){var t,h,p,y,k,n,a,r,o,l,c,i,s,d,b,u,g,f,v,w,m,x,C,K,E,T,S,A,_,F,O,L,q,R,D,P,N,Y,U,J,j,B,G,I,M,z,H,Q,V,W,X,Z,ee,ae,te,re,oe,le,ne={29:0,"02":1,"03":2,"04":3,"05":4,"06":5,"07":6,"08":7,"09":8,"0a":9,"0b":10,"0c":11,"0d":12,10:13,11:14,12:15,13:16,14:17,15:18,16:19,17:20,18:21,19:22,"1a":23,"1b":24,"2b":25,"1e":26,"1f":27,20:28,21:29,22:30,23:31,24:32,25:33,26:34,27:35,28:36,"2c":37,"2d":38,"2e":39,"2f":40,30:41,31:42,32:43,33:44,34:45,35:46},ce={shift:!1,caps:!1,altgrp:!1,shift_altgrp:""},ie=$(this),se=!1,de={keyboardFile:"",arrayPosition:""},pe="",ye=!1,ke="LTR",be=!1,ue="text",ge="text",he=(r=(a=e).acceptColor,o=void 0===r?"#2ECC71":r,l=a.acceptTextColor,c=void 0===l?"#FFFFFF":l,i=a.allowEnterAccept,s=void 0===i||i,d=a.allowEscapeCancel,b=void 0===d||d,u=a.altKey,g=void 0===u?"":u,f=a.blackoutColor,v=void 0===f?"25, 25, 25, 0.9":f,w=a.cancelColor,m=void 0===w?"#E74C3C":w,x=a.cancelTextColor,C=void 0===x?"#FFFFFF":x,K=a.capsLightColor,E=void 0===K?"#3498DB":K,T=a.ctrlKey,S=void 0===T?"":T,A=a.directEnter,_=void 0!==A&&A,F=a.enterKey,O=void 0===F?"":F,L=a.inputFieldRegex,q=void 0===L?{number:/^(-)?(((\d+)|(\d+\.(\d+)?)|(\.(\d+)?))([eE]([-+])?(\d+)?)?)?$/}:L,R=a.inputType,D=void 0===R?"":R,P=a.keyCharacterRegex,N=void 0===P?{number:/[0-9]|[eE]|\.|\+|-/,tel:/[0-9]|\.|\+|-|#|\(|\)/}:P,Y=a.keyColor,U=void 0===Y?"#E0E0E0":Y,J=a.keyTextColor,j=void 0===J?"#555555":J,B=a.keyboardPosition,G=void 0===B?"bottom":B,I=a.language,M=void 0===I?"us":I,z=a.languageKey,H=void 0===z?"":z,Q=a.languageKeyTextColor,V=void 0===Q?"#3498db":Q,W=a.showSelectedLanguage,X=void 0!==W&&W,Z=a.spareKey,ee=void 0===Z?"":Z,ae=a.tabKey,te=void 0===ae?"":ae,{acceptColor:o,acceptTextColor:c,allowEnterAccept:s,allowEscapeCancel:b,altKey:g,blackoutColor:v,cancelColor:m,cancelTextColor:C,capsLightColor:E,ctrlKey:S,directEnter:_,enterKey:O,inputFieldRegex:q,inputType:(re=D,oe=new Array,le="",le=void 0!==re&&""!=re?(oe=re.trim().split(","),$.each(oe,function(e,a){"contenteditable"==a.trim().toString()?le+='[contenteditable="true"], ':"textarea"==a.trim().toString()?le+="textarea, ":le+='input[type="'+a.trim().toString()+'"], '}),le.slice(0,-2)):'input[type="text"], input[type="number"], input[type="password"], input[type="search"], input[type="tel"], input[type="url"], textarea, [contenteditable="true"]'),keyboardPosition:G,keyCharacterRegex:N,keyColor:U,keyTextColor:j,language:M,languageKey:H,languageKeyTextColor:V,showSelectedLanguage:X,spareKey:ee,tabKey:te}),fe={disabled:"",readonly:"",maxlength:"",min:"",max:"",placeholder:""};function ve(a){""!=de.keyboardFile&&de.arrayPosition==h?we(a,de.keyboardFile):$.get("languages/"+a+".klc",function(e){de.keyboardFile=e,de.arrayPosition=h,we(a,e)})}function we(e,a){var t,r,o,l,n,c,i,s,d=new Array;k=y=p="",t=(a=a.replace(/\u0000/g,"")).match(/\d(\w)?\s+\w+\s+\d\s+(-1|\w+@?|%%)\s+(-1|\w+@?|%%)\s+(-1|\w+@?|%%)(\s+(-1|\w+@?|%%))?(\s+(-1|\w+@?|%%))?(\s+(-1|\w+@?|%%))?\s+\/\//g),0<(o=a.indexOf("SHIFTSTATE"))&&((r=a.slice(o,a.indexOf("LAYOUT")).trim().split(/\n/g)).splice(0,2),$.each(r,function(e,a){-1==a.indexOf(":")?p+='"default": ':-1!=a.indexOf("Shft  Ctrl Alt")?p+='"shift_altgrp": ':-1!=a.indexOf("Shft  Ctrl")?p+='"ctrl_shift": ':-1!=a.indexOf("Ctrl Alt")?p+='"altgrp": ':-1!=a.indexOf("Ctrl")?p+='"ctrl": ':-1!=a.indexOf("Shft")&&(p+='"shift": '),p+=a.match(/\w{6}\s[0-9]/).toString().slice(-1)+", "}),p=JSON.parse("{"+p.toString().slice(0,-2)+"}")),0<(n=a.indexOf("DEADKEY"))&&((l=a.slice(n,a.indexOf("KEYNAME")).trim().split("DEADKEY")).splice(0,1),$.each(l,function(e,a){(d=a.split(/\n/g)).splice(0,2),s="",$.each(d,function(e,a){s+='"'+a.trim().slice(0,4)+'": "'+a.trim().slice(5,9)+'", '}),s="{"+s.slice(0,-2)+"}",y+='"'+a.trim().slice(0,4)+'": '+s+", "}),y=JSON.parse("{"+y.slice(0,-2)+"}")),0<(i=a.indexOf("LIGATURE"))&&((c=a.slice(i,a.indexOf("KEYNAME")).trim().split(/\n/g)).splice(0,5),$.each(c,function(t,e){0<e.indexOf("//")&&(c[t]=e.trim().split("//")[0].trim().replace(/\t/g," ").replace("  "," ").replace("  "," ").split(" "),c[t].splice(1,1),k+='"'+c[t][0]+'": ',c[t].splice(0,1),$.each(c[t],function(e,a){c[t][e]='"'+a+'"'}),k+="["+c[t]+"], ")}),k=JSON.parse("{"+k.slice(0,-2)+"}")),ke="arabic"==e?"RTL":"LTR",function(e){var a=e.toString().split(","),t=new Array,r=new Array(47);$.each(a,function(e,a){t[e]=a.toString().replace(/(\t+|\s+)/g," "),t[e]=t[e].split(" "),void 0!==ne[t[e][0]]&&(r[ne[t[e][0]]]=t[e])}),$(".keyboard-wrapper").length?(Ee(),$(".keyboard-row").remove(),!0):($("body").prepend('<div class="keyboard-wrapper"></div>'),he.directEnter||$("body").prepend('<div class="keyboard-blackout-background"></div>'),!1);$e(r.slice(0,13)),$e(r.slice(13,26)),$e(r.slice(26,37)),$e(r.slice(37,47)),xe("default"),y=he.language,k=he.languageKeyTextColor,b=he.showSelectedLanguage,u=y[h].toLowerCase().replace(/^\w/,function(e){return e.toUpperCase()}),g=b?u:"Language",$(".keyboard-action-wrapper").length||he.directEnter||$(".keyboard-wrapper").prepend('<div class="keyboard-action-wrapper"><button class="keyboard-action-button keyboard-cancel-button">Cancel</button><input type="text" class="keyboard-input-field"><button class="keyboard-action-button keyboard-accept-button">Accept</button></div>'),$(".keyboard-row:eq(0)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="backspace">Backspace</button>'),$(".keyboard-row:eq(1)").prepend('<button class="keyboard-key keyboard-key-lg" data-keyval="tab">Tab</button>'),$(".keyboard-row:eq(2)").prepend('<button class="keyboard-key keyboard-key-lg caps-lock-key" data-keyval="caps lock">Caps Lock</button>'),$(".keyboard-row:eq(2)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="enter">Enter</button>'),$(".keyboard-row:eq(3)").prepend('<button class="keyboard-key keyboard-key-lg" data-keyval="shift">Shift</button>'),$(".keyboard-row:eq(3)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="shift">Shift</button>'),$(".keyboard-wrapper").append('<div class="keyboard-row"></div>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="ctrl">Ctrl</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg language-button" data-keyval="language">\n        <span style="color: '.concat(k,';" data-keyval="language">').concat(g,"</span>\n        </button>")),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="alt">Alt</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-xl" data-keyval="space">&nbsp;</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="alt grp">Alt Grp</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="spare">&nbsp;</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="ctrl">Ctrl</button>'),i=$(".keyboard-row").width(),s=2*$(".keyboard-key").css("margin-right").match(/[0-9]/),d=(i-15*s)/15,p=i/3,$(".keyboard-row").each(function(){o=$(this).children(".keyboard-key-sm").length,l=$(this).children(".keyboard-key-lg").length,n=$(this).children(".keyboard-key-xl").length,c=(i-(o+l+n)*s-o*d-n*p)/l,$(this).children(".keyboard-key-sm").css("cssText","width: ".concat(d,"px")),$(this).children(".keyboard-key-lg").css("cssText","width: ".concat(c,"px")),$(this).children(".keyboard-key-xl").css("cssText","width: ".concat(p,"px"))}),function(){var e=$(window).width(),a=$(window).height(),t=$(".keyboard-wrapper").height(),r=$(".keyboard-wrapper").width();switch($(".keyboard-key").css("background-color",he.keyColor),$(".keyboard-key").css("color",he.keyTextColor),he.directEnter||($(".keyboard-cancel-button").css("background-color",he.cancelColor),$(".keyboard-cancel-button").css("color",he.cancelTextColor),$(".keyboard-accept-button").css("background-color",he.acceptColor),$(".keyboard-accept-button").css("color",he.acceptTextColor),$(".keyboard-blackout-background").css("background-color","rgba("+he.blackoutColor+")")),he.keyboardPosition){case"top":$(".keyboard-wrapper").css("top","20px");break;case"middle":$(".keyboard-wrapper").css("top",((a-t)/2).toString()+"px");break;default:$(".keyboard-wrapper").css("bottom","20px")}$(".keyboard-wrapper").css("left",((e-r)/2).toString()+"px")}(),be||(he.directEnter||$(".keyboard-blackout-background").hide(),$(".keyboard-wrapper").hide());var o,l,n,c,i,s,d,p;var y,k,b,u,g}(t)}function $e(e){var r;$(".keyboard-wrapper").append('<div class="keyboard-row"></div>'),$.each(e,function(e,a){var t;r=void 0!==a?{default:me(a[p.default-1],a[1]),shift:me(a[p.shift-1],a[1]),altgrp:me(a[p.altgrp-1],a[1]),shift_altgrp:me(a[p.shift_altgrp-1],a[1])}:{default:"-1",shift:"-1",altgrp:"-1",shift_altgrp:"-1"},t=r,$(".keyboard-row:last").append('<button class="keyboard-key keyboard-key-sm"></button>'),$(".keyboard-key:last").data("keyDataObject",t)})}function me(e,a){var t=e;return"%%"==e?t=k[a]:void 0===e&&(t="-1"),t}function xe(e){var a,t,r="";!ce.caps||ce.shift||ce.altgrp?ce.caps||ce.shift||ce.altgrp||(e="default"):(e="default",$(".caps-lock-key").addClass("caps-lock-key-active")),ce.caps||$(".caps-lock-key").removeClass("caps-lock-key-active"),""!=ce.shift_altgrp&&"shift_altgrp"!=e&&(ce.shift_altgrp=""),$(".keyboard-key").each(function(){r="";try{a=$(this),4==(t=a.data("keyDataObject"))[e].length?(a.html("&#x"+t[e]+";"),a.data("keyval",a.html())):5==t[e].length&&t[e].match("@")?(a.html("&#x"+t[e].replace("@","")+";"),a.data("keyval",a.html())):t[e].constructor===Array?($.each(t[e],function(e,a){r+="&#x"+a+";"}),a.html(r),a.data("keyval",a.html())):"-1"==t[e]||"%%"==t[e]||0==t[e].length?(a.html("&nbsp;"),a.data("keyval","")):(a.html(t[e]),a.data("keyval",a.html())),ce.shift||!ce.caps||ce.altgrp||(a.html(1==a.html().length?a.html().toUpperCase():a.html()),a.data("keyval",1==a.html().length?a.html():a.data("keyval")))}catch(e){}})}function Ce(){n.val(""),Ee(),be=!1,ve(he.language[h])}function Ke(){t.is("input")?t.val(n.val()):t.html(n.val()),n.val(""),Ee(),be=!1,ve(he.language[h])}function Ee(){for(var e in ce)ce.hasOwnProperty(e)&&(ce[e]=!1)}he.language=he.language.split(","),$.each(he.language,function(e,a){he.language[e]=a.trim()}),h=0,ve(he.language[h]),ie.on("click touch",he.inputType,function(){if("keyboard-input-field"!=$(this).prop("class")){var a=$(this);$.each(fe,function(e){fe[e]=void 0===a.prop(e)?"":a.prop(e)}),fe.disabled||fe.readonly||(t=$(this),n=t,he.directEnter||(n=$(".keyboard-input-field"),t.is("input")?(ue=t.prop("type"),ge="password"==ue?"password":"text",n.prop("placeholder",fe.placeholder),n.val(t.val()),n.prop("type",ge)):(ue="text",n.val(t.html()),n.prop("type","text")),$(".keyboard-blackout-background").show()),$(".keyboard-wrapper").show(),be=!0,n.focus())}}),$("body").on("click touch",".keyboard-key",function(){var e=$(this).data("keyval");!function(e){var a=("0000"+e.charCodeAt(0).toString(16)).slice(-4),t=n[0].selectionStart;if(2<(e=e.replace("&lt;","<").replace("&gt;",">").replace(/\bspace/," ")).length)switch(pe="",e){case"shift":ce.shift=!ce.shift,ce.caps=!1,ce.altgrp=!1,"altgrp"==ce.shift_altgrp?(xe("shift_altgrp"),ce.shift_altgrp=""):"shift"==ce.shift_altgrp?(xe("shift"),ce.shift_altgrp=""):(xe("shift"),ce.shift_altgrp="shift");break;case"caps lock":ce.shift=!1,ce.caps=!ce.caps,ce.altgrp=!1,xe("caps");break;case"alt grp":ce.shift=!1,ce.caps=!1,ce.altgrp=!ce.altgrp,"shift"==ce.shift_altgrp?(xe("shift_altgrp"),ce.shift_altgrp=""):"altgrp"==ce.shift_altgrp?(xe("altgrp"),ce.shift_altgrp=""):(xe("altgrp"),ce.shift_altgrp="altgrp");break;case"backspace":n.val(n.val().slice(0,t-1)+n.val().slice(t)),t-=1,n.focus(),n[0].selectionStart=t,n[0].selectionEnd=t;break;case"space":break;case"enter":he.enterKey&&"function"==typeof he.enterKey&&he.enterKey();break;case"tab":he.tabKey&&"function"==typeof he.tabKey&&he.tabKey();break;case"ctrl":he.ctrlKey&&"function"==typeof he.ctrlKey&&he.ctrlKey();break;case"alt":he.altKey&&"function"==typeof he.altKey&&he.altKey();break;case"language":h+1<=he.language.length-1?h++:h=0,Ee(),ve(he.language[h]),he.languageKey&&"function"==typeof he.languageKey&&he.languageKey();break;case"spare":he.spareKey&&he.spareKey}else{if(ce.shift=!1,ce.altgrp=!1,xe("default"),(pe=y[a])||ye){if(e="",void 0===pe&&ye){var r=String.fromCharCode("0x"+ye[a]);r&&void 0!==ye[a]&&(e=r)}ye=pe}n.attr("dir",ke);var o,l=n.val();n.val(n.val().slice(0,t)+e+n.val().slice(t)),o=n.val(),("-1"!=fe.maxlength&&""!=fe.maxlength&&o.length>fe.maxlength||"number"==ue&&""!=fe.max&&"-1"!=fe.max&&1*o>1*fe.max||"number"==ue&&""!=fe.min&&"-1"!=fe.min&&1*o<1*fe.min||e.search(he.keyCharacterRegex[ue])<0||o.search(he.inputFieldRegex[ue])<0)&&(n.val(l),t--),t+=e.length,n.focus(),n[0].selectionStart=t,n[0].selectionEnd=t}}(e)}),$(document).on("click touch",".keyboard-cancel-button",function(){Ce()}),$(document).on("click touch",".keyboard-accept-button",function(){Ke()}),$(document).on("click touch","*",function(e){if(e.stopPropagation(),be&&he.directEnter){var a=$(this);if(he.inputType.search(a.attr("type"))<1&&he.inputType.search(a.prop("tagName").toLowerCase())<1&&"true"!=a.prop("contenteditable")){for(;a.parent().length&&!a.hasClass("keyboard-wrapper");)a=a.parent();a.hasClass("keyboard-wrapper")||(Ee(),be=!1,ve(he.language[h]))}}}),$(document).on("keydown",function(e){!function(e){if($(".keyboard-wrapper").is(":visible"))switch(e.which){case 13:he.allowEnterAccept&&(Ke(),e.preventDefault());break;case 27:he.allowEscapeCancel&&(Ce(),e.preventDefault())}}(e)}),$(window).resize(function(){se||(se=!0,setTimeout(function(){ve(he.language[h]),se=!1},500))})};
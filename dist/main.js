"use strict";$.fn.keyboard=function(e){var r,p,y,k,c,t,a,o,l,n,i,s,d,b,u,h,g,f,v,w,m,x,C,K,E,T,S,F,O,A,_,L,q,R,D,P,N,Y,U,J,j,B,G,I,M,z,H,Q,V,W,X,Z,ee,te,ae,re,oe,le,ce,ne,ie={29:0,"02":1,"03":2,"04":3,"05":4,"06":5,"07":6,"08":7,"09":8,"0a":9,"0b":10,"0c":11,"0d":12,10:13,11:14,12:15,13:16,14:17,15:18,16:19,17:20,18:21,19:22,"1a":23,"1b":24,"2b":25,"1e":26,"1f":27,20:28,21:29,22:30,23:31,24:32,25:33,26:34,27:35,28:36,"2c":37,"2d":38,"2e":39,"2f":40,30:41,31:42,32:43,33:44,34:45,35:46},se={shift:!1,caps:!1,altgrp:!1,shift_altgrp:""},de=$(this),pe=!1,ye=0,ke={keyboardFile:"",arrayPosition:""},be="",ue=!1,he="LTR",ge=!1,fe="text",ve="text",we="Language",$e=":",me="triggerKeyboard",xe=(o=(t=e).acceptColor,l=void 0===o?"#2ECC71":o,n=t.acceptTextColor,i=void 0===n?"#FFFFFF":n,s=t.allowEnterAccept,d=void 0===s||s,b=t.allowEscapeCancel,u=void 0===b||b,h=t.altKey,g=void 0===h?"":h,f=t.blackoutColor,v=void 0===f?"25, 25, 25, 0.9":f,w=t.cancelColor,m=void 0===w?"#E74C3C":w,x=t.cancelTextColor,C=void 0===x?"#FFFFFF":x,K=t.capsLightColor,E=void 0===K?"#3498DB":K,T=t.ctrlKey,S=void 0===T?"":T,F=t.directEnter,O=void 0!==F&&F,A=t.enterKey,_=void 0===A?"":A,L=t.inputFieldRegex,q=void 0===L?{number:/^(-)?(((\d+)|(\d+\.(\d+)?)|(\.(\d+)?))([eE]([-+])?(\d+)?)?)?$/}:L,R=t.inputType,D=void 0===R?"":R,P=t.keyCharacterRegex,N=void 0===P?{number:/[0-9]|[eE]|\.|\+|-/,tel:/[0-9]|\.|\+|-|#|\(|\)/}:P,Y=t.keyColor,U=void 0===Y?"#E0E0E0":Y,J=t.keyTextColor,j=void 0===J?"#555555":J,B=t.keyboardPosition,G=void 0===B?"bottom":B,I=t.language,M=void 0===I?"":I,z=t.languageKey,H=void 0===z?"":z,Q=t.languageKeyTextColor,V=void 0===Q?"#3498db":Q,W=t.showSelectedLanguage,X=void 0!==W&&W,Z=t.spareKey,ee=void 0===Z?"":Z,te=t.specifiedFieldsOnly,ae=void 0!==te&&te,re=t.tabKey,oe=void 0===re?"":re,{acceptColor:l,acceptTextColor:i,allowEnterAccept:d,allowEscapeCancel:u,altKey:g,blackoutColor:v,cancelColor:m,cancelTextColor:C,capsLightColor:E,ctrlKey:S,directEnter:O,enterKey:_,inputFieldRegex:q,inputType:(le=D,ce=new Array,ne="",ne=void 0!==le&&""!=le?(ce=le.trim().split(","),$.each(ce,function(e,t){"contenteditable"==t.trim().toString()?ne+='[contenteditable="true"], ':"textarea"==t.trim().toString()?ne+="textarea, ":ne+='input[type="'+t.trim().toString()+'"], '}),ne.slice(0,-2)):'input[type="text"], input[type="number"], input[type="password"], input[type="search"], input[type="tel"], input[type="url"], textarea, [contenteditable="true"]'),keyboardPosition:G,keyCharacterRegex:N,keyColor:U,keyTextColor:j,language:(a=M,a.split(",").map(function(e){return e.trim()})),languageKey:H,languageKeyTextColor:V,showSelectedLanguage:X,spareKey:ee,specifiedFieldsOnly:ae,tabKey:oe}),Ce={disabled:"",readonly:"",maxlength:"",min:"",max:"",placeholder:""};function Ke(){var t=xe.language[ye].split($e)[0].trim();""!=ke.keyboardFile&&ke.arrayPosition==ye?Ee(t,ke.keyboardFile):$.get("./languages/".concat(t,".klc"),function(e){ke.keyboardFile=e,ke.arrayPosition=ye,Ee(t,e)})}function Ee(e,t){var a,r,o,l,c,n,i,s,d=new Array;k=y=p="",a=(t=t.replace(/\u0000/g,"")).match(/\d(\w)?\s+\w+\s+\d\s+(-1|\w+@?|%%)\s+(-1|\w+@?|%%)\s+(-1|\w+@?|%%)(\s+(-1|\w+@?|%%))?(\s+(-1|\w+@?|%%))?(\s+(-1|\w+@?|%%))?\s+\/\//g),0<(o=t.indexOf("SHIFTSTATE"))&&((r=t.slice(o,t.indexOf("LAYOUT")).trim().split(/\n/g)).splice(0,2),$.each(r,function(e,t){-1==t.indexOf(":")?p+='"default": ':-1!=t.indexOf("Shft  Ctrl Alt")?p+='"shift_altgrp": ':-1!=t.indexOf("Shft  Ctrl")?p+='"ctrl_shift": ':-1!=t.indexOf("Ctrl Alt")?p+='"altgrp": ':-1!=t.indexOf("Ctrl")?p+='"ctrl": ':-1!=t.indexOf("Shft")&&(p+='"shift": '),p+=t.match(/\w{6}\s[0-9]/).toString().slice(-1)+", "}),p=JSON.parse("{"+p.toString().slice(0,-2)+"}")),0<(c=t.indexOf("DEADKEY"))&&((l=t.slice(c,t.indexOf("KEYNAME")).trim().split("DEADKEY")).splice(0,1),$.each(l,function(e,t){(d=t.split(/\n/g)).splice(0,2),s="",$.each(d,function(e,t){s+='"'+t.trim().slice(0,4)+'": "'+t.trim().slice(5,9)+'", '}),s="{"+s.slice(0,-2)+"}",y+='"'+t.trim().slice(0,4)+'": '+s+", "}),y=JSON.parse("{"+y.slice(0,-2)+"}")),0<(i=t.indexOf("LIGATURE"))&&((n=t.slice(i,t.indexOf("KEYNAME")).trim().split(/\n/g)).splice(0,5),$.each(n,function(a,e){0<e.indexOf("//")&&(n[a]=e.trim().split("//")[0].trim().replace(/\t/g," ").replace("  "," ").replace("  "," ").split(" "),n[a].splice(1,1),k+='"'+n[a][0]+'": ',n[a].splice(0,1),$.each(n[a],function(e,t){n[a][e]='"'+t+'"'}),k+="["+n[a]+"], ")}),k=JSON.parse("{"+k.slice(0,-2)+"}")),he="arabic"==e?"RTL":"LTR",function(e){var t=e.toString().split(","),a=new Array,r=new Array(47);$.each(t,function(e,t){a[e]=t.toString().replace(/(\t+|\s+)/g," "),a[e]=a[e].split(" "),void 0!==ie[a[e][0]]&&(r[ie[a[e][0]]]=a[e])}),$(".keyboard-wrapper").length?(_e(),$(".keyboard-row").remove(),!0):($("body").prepend('<div class="keyboard-wrapper"></div>'),xe.directEnter||$("body").prepend('<div class="keyboard-blackout-background"></div>'),!1);Te(r.slice(0,13)),Te(r.slice(13,26)),Te(r.slice(26,37)),Te(r.slice(37,47)),Fe("default"),y=xe.language,k=xe.languageKeyTextColor,b=xe.showSelectedLanguage,u=b?function(){var e=y[ye].split($e),t="";switch(e.length){case 1:t=e[0].toLowerCase().replace(/^\w/,function(e){return e.toUpperCase()});break;case 2:t=e[1].trim();break;default:t=we}return t}():we,$(".keyboard-action-wrapper").length||xe.directEnter||$(".keyboard-wrapper").prepend('<div class="keyboard-action-wrapper"><button class="keyboard-action-button keyboard-cancel-button">Cancel</button><input type="text" class="keyboard-input-field"><button class="keyboard-action-button keyboard-accept-button">Accept</button></div>'),$(".keyboard-row:eq(0)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="backspace">Backspace</button>'),$(".keyboard-row:eq(1)").prepend('<button class="keyboard-key keyboard-key-lg" data-keyval="tab">Tab</button>'),$(".keyboard-row:eq(2)").prepend('<button class="keyboard-key keyboard-key-lg caps-lock-key" data-keyval="caps lock">Caps Lock</button>'),$(".keyboard-row:eq(2)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="enter">Enter</button>'),$(".keyboard-row:eq(3)").prepend('<button class="keyboard-key keyboard-key-lg" data-keyval="shift">Shift</button>'),$(".keyboard-row:eq(3)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="shift">Shift</button>'),$(".keyboard-wrapper").append('<div class="keyboard-row"></div>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="ctrl">Ctrl</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg language-button" data-keyval="language">\n        <span style="color: '.concat(k,';" data-keyval="language">').concat(u,"</span>\n        </button>")),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="alt">Alt</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-xl" data-keyval="space">&nbsp;</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="alt grp">Alt Grp</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="spare">&nbsp;</button>'),$(".keyboard-row:eq(4)").append('<button class="keyboard-key keyboard-key-lg" data-keyval="ctrl">Ctrl</button>'),i=$(".keyboard-row").width(),s=2*$(".keyboard-key").css("margin-right").match(/[0-9]/),d=(i-15*s)/15,p=i/3,$(".keyboard-row").each(function(){o=$(this).children(".keyboard-key-sm").length,l=$(this).children(".keyboard-key-lg").length,c=$(this).children(".keyboard-key-xl").length,n=(i-(o+l+c)*s-o*d-c*p)/l,$(this).children(".keyboard-key-sm").css("cssText","width: ".concat(d,"px")),$(this).children(".keyboard-key-lg").css("cssText","width: ".concat(n,"px")),$(this).children(".keyboard-key-xl").css("cssText","width: ".concat(p,"px"))}),function(){var e=$(window).width(),t=$(window).height(),a=$(".keyboard-wrapper").height(),r=$(".keyboard-wrapper").width();switch($(".keyboard-key").css("background-color",xe.keyColor),$(".keyboard-key").css("color",xe.keyTextColor),xe.directEnter||($(".keyboard-cancel-button").css("background-color",xe.cancelColor),$(".keyboard-cancel-button").css("color",xe.cancelTextColor),$(".keyboard-accept-button").css("background-color",xe.acceptColor),$(".keyboard-accept-button").css("color",xe.acceptTextColor),$(".keyboard-blackout-background").css("background-color","rgba("+xe.blackoutColor+")")),xe.keyboardPosition){case"top":$(".keyboard-wrapper").css("top","20px");break;case"middle":$(".keyboard-wrapper").css("top",((t-a)/2).toString()+"px");break;default:$(".keyboard-wrapper").css("bottom","20px")}$(".keyboard-wrapper").css("left",((e-r)/2).toString()+"px")}(),ge||(xe.directEnter||$(".keyboard-blackout-background").hide(),$(".keyboard-wrapper").hide());var o,l,c,n,i,s,d,p;var y,k,b,u}(a)}function Te(e){var r;$(".keyboard-wrapper").append('<div class="keyboard-row"></div>'),$.each(e,function(e,t){var a;r=void 0!==t?{default:Se(t[p.default-1],t[1]),shift:Se(t[p.shift-1],t[1]),altgrp:Se(t[p.altgrp-1],t[1]),shift_altgrp:Se(t[p.shift_altgrp-1],t[1])}:{default:"-1",shift:"-1",altgrp:"-1",shift_altgrp:"-1"},a=r,$(".keyboard-row:last").append('<button class="keyboard-key keyboard-key-sm"></button>'),$(".keyboard-key:last").data("keyDataObject",a)})}function Se(e,t){var a=e;return"%%"==e?a=k[t]:void 0===e&&(a="-1"),a}function Fe(e){var t,a,r="";!se.caps||se.shift||se.altgrp?se.caps||se.shift||se.altgrp||(e="default"):(e="default",$(".caps-lock-key").addClass("caps-lock-key-active")),se.caps||$(".caps-lock-key").removeClass("caps-lock-key-active"),""!=se.shift_altgrp&&"shift_altgrp"!=e&&(se.shift_altgrp=""),$(".keyboard-key").each(function(){r="";try{t=$(this),4==(a=t.data("keyDataObject"))[e].length?(t.html("&#x"+a[e]+";"),t.data("keyval",t.html())):5==a[e].length&&a[e].match("@")?(t.html("&#x"+a[e].replace("@","")+";"),t.data("keyval",t.html())):a[e].constructor===Array?($.each(a[e],function(e,t){r+="&#x"+t+";"}),t.html(r),t.data("keyval",t.html())):"-1"==a[e]||"%%"==a[e]||0==a[e].length?(t.html("&nbsp;"),t.data("keyval","")):(t.html(a[e]),t.data("keyval",t.html())),se.shift||!se.caps||se.altgrp||(t.html(1==t.html().length?t.html().toUpperCase():t.html()),t.data("keyval",1==t.html().length?t.html():t.data("keyval")))}catch(e){}})}function Oe(){c.val(""),_e(),ge=!1,Ke()}function Ae(){r.is("input")?r.val(c.val()):r.html(c.val()),c.val(""),_e(),ge=!1,Ke()}function _e(){for(var e in se)se.hasOwnProperty(e)&&(se[e]=!1)}Ke(),de.on("click touch",xe.inputType,function(){var e=xe.specifiedFieldsOnly;if("keyboard-input-field"!=$(this).prop("class")){var t=$(this);if(e){var a=t.data(me)||!1;if(!a)return}$.each(Ce,function(e){Ce[e]=void 0===t.prop(e)?"":t.prop(e)}),Ce.disabled||Ce.readonly||(r=$(this),c=r,xe.directEnter||(c=$(".keyboard-input-field"),r.is("input")?(fe=r.prop("type"),ve="password"==fe?"password":"text",c.prop("placeholder",Ce.placeholder),c.val(r.val()),c.prop("type",ve)):(fe="text",c.val(r.html()),c.prop("type","text")),$(".keyboard-blackout-background").show()),$(".keyboard-wrapper").show(),ge=!0,c.focus())}}),$("body").on("click touch",".keyboard-key",function(){var e=$(this).data("keyval");!function(e){var t=("0000"+e.charCodeAt(0).toString(16)).slice(-4),a=c[0].selectionStart;if(2<(e=e.replace("&lt;","<").replace("&gt;",">").replace(/\bspace/," ")).length)switch(be="",e){case"shift":se.shift=!se.shift,se.caps=!1,se.altgrp=!1,"altgrp"==se.shift_altgrp?(Fe("shift_altgrp"),se.shift_altgrp=""):"shift"==se.shift_altgrp?(Fe("shift"),se.shift_altgrp=""):(Fe("shift"),se.shift_altgrp="shift");break;case"caps lock":se.shift=!1,se.caps=!se.caps,se.altgrp=!1,Fe("caps");break;case"alt grp":se.shift=!1,se.caps=!1,se.altgrp=!se.altgrp,"shift"==se.shift_altgrp?(Fe("shift_altgrp"),se.shift_altgrp=""):"altgrp"==se.shift_altgrp?(Fe("altgrp"),se.shift_altgrp=""):(Fe("altgrp"),se.shift_altgrp="altgrp");break;case"backspace":c.val(c.val().slice(0,a-1)+c.val().slice(a)),a-=1,c.focus(),c[0].selectionStart=a,c[0].selectionEnd=a;break;case"space":break;case"enter":xe.enterKey&&"function"==typeof xe.enterKey&&xe.enterKey();break;case"tab":xe.tabKey&&"function"==typeof xe.tabKey&&xe.tabKey();break;case"ctrl":xe.ctrlKey&&"function"==typeof xe.ctrlKey&&xe.ctrlKey();break;case"alt":xe.altKey&&"function"==typeof xe.altKey&&xe.altKey();break;case"language":ye+1<=xe.language.length-1?ye++:ye=0,_e(),Ke(),xe.languageKey&&"function"==typeof xe.languageKey&&xe.languageKey();break;case"spare":xe.spareKey&&xe.spareKey}else{if(se.shift=!1,se.altgrp=!1,Fe("default"),(be=y[t])||ue){if(e="",void 0===be&&ue){var r=String.fromCharCode("0x"+ue[t]);r&&void 0!==ue[t]&&(e=r)}ue=be}c.attr("dir",he);var o,l=c.val();c.val(c.val().slice(0,a)+e+c.val().slice(a)),o=c.val(),("-1"!=Ce.maxlength&&""!=Ce.maxlength&&o.length>Ce.maxlength||"number"==fe&&""!=Ce.max&&"-1"!=Ce.max&&1*o>1*Ce.max||"number"==fe&&""!=Ce.min&&"-1"!=Ce.min&&1*o<1*Ce.min||e.search(xe.keyCharacterRegex[fe])<0||o.search(xe.inputFieldRegex[fe])<0)&&(c.val(l),a--),a+=e.length,c.focus(),c[0].selectionStart=a,c[0].selectionEnd=a}}(e)}),$(document).on("click touch",".keyboard-cancel-button",function(){Oe()}),$(document).on("click touch",".keyboard-accept-button",function(){Ae()}),$(document).on("click touch","*",function(e){if(e.stopPropagation(),ge&&xe.directEnter){var t=$(this);if(xe.inputType.search(t.attr("type"))<1&&xe.inputType.search(t.prop("tagName").toLowerCase())<1&&"true"!=t.prop("contenteditable")){for(;t.parent().length&&!t.hasClass("keyboard-wrapper");)t=t.parent();t.hasClass("keyboard-wrapper")||(_e(),ge=!1,Ke())}}}),$(document).on("keydown",function(e){!function(e){if($(".keyboard-wrapper").is(":visible"))switch(e.which){case 13:xe.allowEnterAccept&&(Ae(),e.preventDefault());break;case 27:xe.allowEscapeCancel&&(Oe(),e.preventDefault())}}(e)}),$(window).resize(function(){pe||(pe=!0,setTimeout(function(){Ke(),pe=!1},500))})};